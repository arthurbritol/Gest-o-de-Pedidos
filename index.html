<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>Gestão de Pedidos (Carregamento e Separação)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" type="image/jpg" href="favicon.ico"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-blue: #007bff;
            --dark-blue: #0056b3;
            --light-gray: #f8f9fa;
            --medium-gray: #e9ecef;
            --dark-gray: #343a40;
            --text-secondary: #6c757d;
            --white: #ffffff;
            --red-error: #dc3545;
            --green-success: #28a745;
            --yellow-warning: #ffc107;
            --blue-info: #17a2b8;
            --orange-warning: #fd7e14;
            --shadow-light: rgba(0, 0, 0, 0.08);
            --shadow-medium: rgba(0, 0, 0, 0.15);
            --border-radius-small: 8px;
            --border-radius-medium: 12px;
            --border-radius-large: 20px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--light-gray);
            color: var(--dark-gray);
            line-height: 1.6;
            font-size: 17px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .login-container, .filter-screen-container {
            display: flex;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            background-color: var(--light-gray);
            padding: 20px;
        }

        .login-box, .filter-box {
            background: var(--white);
            padding: 55px;
            border-radius: var(--border-radius-medium);
            box-shadow: 0 18px 50px var(--shadow-medium);
            width: 100%;
            max-width: 1200px;
            text-align: center;
            animation: fadeIn 0.7s ease-out;
            border: 3px solid var(--medium-gray);
        }

        .login-box h2, .filter-box h2 {
            margin-bottom: 25px;
            font-weight: 700;
            color: var(--primary-blue);
            font-size: 30px;
        }

        .login-box input, .login-box button,
        .filter-box input, .filter-box select, .filter-box button {
            width: 100%;
            padding: 18px 0px;
            margin-bottom: 15px;
            font-size: 17px;
            border-radius: var(--border-radius-small);
            border: 1px solid var(--medium-gray);
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }

        .login-box input:focus, .filter-box input:focus, .filter-box select:focus {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
            outline: none;
        }

        .login-box button, .filter-box button {
            background-color: var(--primary-blue);
            color: var(--white);
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 19px;
            letter-spacing: 3.5px;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3);
            margin-top: 40px;
        }

        .login-box button:hover, .filter-box button:hover {
            background-color: var(--dark-blue);
            box-shadow: 0 6px 15px rgba(0, 123, 255, 0.4);
            transform: translateY(-2px);
        }

        .login-error {
            color: var(--red-error);
            font-size: 15px;
            margin-top: -10px;
            margin-bottom: 15px;
            animation: shake 0.5s;
        }

        .header {
            background-color: var(--primary-blue);
            color: var(--white);
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px var(--shadow-medium);
            position: sticky;
            top: 0;
            z-index: 999;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .title {
            font-size: 25px;
            font-weight: 700;
        }

        .btn-logout, .btn-back, .btn-back-to-all-orders {
            background: var(--dark-blue);
            border: none;
            color: var(--white);
            padding: 10px 20px;
            font-size: 15px;
            border-radius: var(--border-radius-small);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            box-shadow: 0 2px 6px var(--shadow-light);
        }

        .btn-logout:hover, .btn-back:hover, .btn-back-to-all-orders:hover {
            background: #2a6bb3;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px var(--shadow-medium);
        }

        .container {
            padding: 30px 20px;
            max-width: 1000px;
            margin: auto;
        }

        .card {
            background-color: var(--white);
            margin-bottom: 25px;
            padding: 25px 30px;
            border-radius: var(--border-radius-medium);
            box-shadow: 0 5px 15px var(--shadow-light);
            animation: fadeIn 0.8s ease-out;
            border: 1px solid var(--medium-gray);
        }

        .pedido-header h3 {
            margin: 0 0 8px;
            color: var(--primary-blue);
            font-size: 23px;
            font-weight: 600;
        }

        .pedido-header p {
            margin: 4px 0;
            font-size: 15px;
            color: var(--text-secondary);
        }
        
        .pedido-header p.status-pedido {
            font-weight: bold;
            font-size: 16px;
        }
        .status-aguardando-separacao {
            color: var(--primary-blue);
        }
        .status-em-separacao {
            color: var(--orange-warning);
        }
        .status-pedido-separado {
            color: var(--green-success);
        }


        .pedido-header h4 {
            margin-top: 15px;
            margin-bottom: 10px;
            font-size: 19px;
            color: var(--dark-gray);
            border-bottom: 1px solid var(--medium-gray);
            padding-bottom: 5px;
        }

        .welcome {
            font-size: 28px;
            margin-bottom: 30px;
            font-weight: 600;
            color: var(--dark-blue);
            text-align: center;
        }

        .item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 17px;
            color: var(--dark-gray);
            background-color: var(--light-gray);
            padding: 10px 15px;
            border-radius: var(--border-radius-small);
            border: 1px solid var(--medium-gray);
            transition: background-color 0.2s ease;
        }
        .item:hover {
            background-color: #f0f2f5;
        }


        .item input {
            margin-left: 15px;
            padding: 8px 12px;
            border: 1px solid var(--medium-gray);
            border-radius: var(--border-radius-small);
            width: 180px;
            font-size: 16px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .item input:disabled {
            background-color: var(--medium-gray);
            color: var(--dark-gray);
            cursor: not-allowed;
            opacity: 1;
        }

        .card .buttons-row {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .card .buttons-row button {
            margin: 0;
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius-small);
            background-color: var(--primary-blue);
            color: var(--white);
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px var(--shadow-light);
        }

        .card .buttons-row button.btn-iniciar-separacao {
            background-color: var(--blue-info);
        }
        .card .buttons-row button.btn-iniciar-separacao:hover:not(:disabled) {
            background-color: #117a8b;
        }

        .card .buttons-row button.btn-salvar-peso {
            background-color: var(--primary-blue);
        }
        .card .buttons-row button.btn-salvar-peso:hover:not(:disabled) {
            background-color: var(--dark-blue);
        }

        .card .buttons-row button.btn-enviar {
            background-color: var(--green-success);
        }
        .card .buttons-row button.btn-enviar:hover:not(:disabled) {
            background-color: #218838;
        }

        .card .buttons-row button:hover:not(:disabled) {
            background-color: var(--dark-blue);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px var(--shadow-medium);
        }

        .card .buttons-row button:disabled {
            background-color: #a0cffc;
            cursor: not-allowed;
            opacity: 0.7;
            box-shadow: none;
        }


        #mainApp, #filterScreen { display: none; }

        .quotations-section {
            margin-bottom: 25px;
            border-top: 1px solid var(--medium-gray);
            padding-top: 20px;
            margin-top: 20px;
        }

        .quotations-section h3 {
            color: var(--dark-blue);
            font-size: 21px;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .quotation-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px dashed var(--medium-gray);
        }

        .quotation-item:last-child {
            border-bottom: none;
        }

        .quotation-item span {
            font-size: 16px;
            color: var(--dark-gray);
            font-weight: 500;
        }

        .quotation-item button {
            margin-top: 0;
            padding: 8px 15px;
            font-size: 14px;
            background-color: var(--green-success);
            border-radius: var(--border-radius-small);
            border: none;
            color: var(--white);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quotation-item button:hover {
            background-color: #218838;
            transform: translateY(-1px);
        }

        .summary-section {
            margin-top: 25px;
            text-align: left;
            padding-top: 20px;
            border-top: 1px solid var(--medium-gray);
        }

        .summary-section h3 {
            font-size: 21px;
            color: var(--dark-blue);
            margin-bottom: 15px;
            font-weight: 600;
            text-align: center;
        }


        #embarqueSummary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            justify-content: center;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
            color: var(--dark-gray);
            background-color: var(--white); 
            padding: 12px 18px;
            border-radius: var(--border-radius-small);
            box-shadow: 0 2px 8px var(--shadow-light);
            transition: all 0.3s ease;
            flex-grow: 1;
            border: 1px solid var(--medium-gray);
        }

        .summary-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px var(--shadow-medium);
        }

        .summary-item span {
            font-weight: 600;
            color: var(--primary-blue);
            font-size: 1.2em;
        }
        

        .summary-item button:hover {
            background-color: var(--dark-blue);
        }
        .summary-item button {
            background-color: var(--primary-blue);
            color: white;
        }


        .filter-box-button-bottom {
            width: 100%;
            padding: 14px 25px;
            margin-top: 25px;
            background-color: var(--primary-blue);
            color: var(--white);
            border: none;
            border-radius: var(--border-radius-small);
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3);
        }

        .filter-box-button-bottom:hover {
            background-color: var(--dark-blue);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 123, 255, 0.4);
        }

        #mainApp, #filterScreen { display: none; }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
            display: flex;
        }

        .modal-content {
            background-color: var(--white);
            padding: 30px;
            border-radius: var(--border-radius-medium);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
            width: 90%;
            max-width: 450px;
            text-align: center;
            transform: translateY(-20px);
            transition: transform 0.4s ease;
            position: relative;
            border: 1px solid var(--medium-gray);
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }

        .modal-content h3 {
            color: var(--primary-blue);
            margin-bottom: 20px;
            font-size: 26px;
            font-weight: 600;
        }

        .modal-content p {
            color: var(--dark-gray);
            margin-bottom: 25px;
            font-size: 17px;
            line-height: 1.5;
        }

        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .modal-button {
            padding: 12px 25px;
            border: none;
            border-radius: var(--border-radius-small);
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 2px 6px var(--shadow-light);
        }

        .modal-button.confirm {
            background-color: var(--primary-blue);
            color: var(--white);
        }

        .modal-button.confirm:hover {
            background-color: var(--dark-blue);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px var(--shadow-medium);
        }

        .modal-button.cancel {
            background-color: var(--text-secondary);
            color: var(--white);
        }

        .modal-button.cancel:hover {
            background-color: #5a6268;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px var(--shadow-medium);
        }

        .modal-button.ok {
            background-color: var(--green-success);
            color: var(--white);
        }

        .modal-button.ok:hover {
            background-color: #218838;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px var(--shadow-medium);
        }

        .modal-close-button {
            position: absolute;
            top: 15px;
            right: 18px;
            font-size: 30px;
            color: var(--text-secondary);
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            line-height: 1;
            transition: color 0.3s ease;
        }

        .modal-close-button:hover {
            color: var(--dark-gray);
        }

        .main-app-status-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .main-app-status-filters button {
            background-color: var(--medium-gray);
            color: var(--dark-gray);
            border: 1px solid #d0d7e0;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: var(--border-radius-small);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            box-shadow: 0 1px 4px var(--shadow-light);
        }

        .main-app-status-filters button:hover {
            background-color: #dbe4ec;
            transform: translateY(-1px);
        }

        .main-app-status-filters button.active {
            background-color: var(--primary-blue);
            color: var(--white);
            border-color: var(--primary-blue);
            font-weight: 600;
            box-shadow: 0 3px 9px rgba(0, 123, 255, 0.3);
            transform: translateY(-1px);
        }

        .material-filters {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 25px;
        }
        .material-filters button {
            padding: 10px 18px;
            font-size: 16px;
            border-radius: 20px;
            background-color: var(--medium-gray);
            color: var(--dark-gray);
            border: 1px solid #c0c7d0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .material-filters button:hover {
            background-color: #dbe4ec;
            transform: translateY(-1px);
        }
        .material-filters button.active {
            background-color: var(--primary-blue);
            color: var(--white);
            border-color: var(--primary-blue);
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.2);
        }


        @media screen and (max-width: 768px) {
            .modal-content { padding: 25px; }
            .modal-content h3 { font-size: 24px; }
            .modal-content p { font-size: 16px; }
            .modal-buttons { flex-direction: column; gap: 10px; }
            .modal-button { width: 100%; padding: 10px; font-size: 15px; }
            #embarqueSummary { grid-template-columns: repeat(2, 1fr); }
            .main-app-status-filters { gap: 8px; }
            .main-app-status-filters button { flex-grow: 1; font-size: 15px; padding: 9px 15px; }
            .header { padding: 12px 15px; }
            .title { font-size: 22px; }
            .btn-logout, .btn-back, .btn-back-to-all-orders { padding: 8px 15px; font-size: 14px; }
            .container { padding: 20px 15px; }
            .welcome { font-size: 24px; margin-bottom: 25px; }
            .card { padding: 20px 25px; }
            .pedido-header h3 { font-size: 21px; }
            .pedido-header p { font-size: 14px; }
            .pedido-header h4 { font-size: 17px; }
            .item { flex-direction: column; align-items: flex-start; padding: 10px; }
            .item span { margin-bottom: 5px; }
            .item input { margin-left: 0; width: 100%; font-size: 15px; }
            .card .buttons-row { justify-content: center; }
            .quotations-section h3 { font-size: 19px; }
            .quotation-item span { font-size: 15px; }
            .quotation-item button { padding: 7px 12px; font-size: 13px; }
            .summary-section h3 { font-size: 19px; }
            .summary-item { padding: 10px 15px; font-size: 15px; }
            .summary-item span { font-size: 1.1em; }
            .filter-box-button-bottom { padding: 13px 20px; font-size: 17px; }
        }

        @media screen and (max-width: 480px) {
            .login-box, .filter-box { padding: 25px; max-width: 350px; }
            .login-box h2, .filter-box h2 { font-size: 26px; }
            .login-box input, .login-box button,
            .filter-box input, .filter-box select, .filter-box button { padding: 12px 15px; font-size: 16px; }
            .login-box button, .filter-box button { font-size: 17px; }
            .modal-content { padding: 20px; border-radius: var(--border-radius-medium); }
            .modal-content h3 { font-size: 22px; }
            .modal-content p { font-size: 15px; }
            .main-app-status-filters button { font-size: 14px; padding: 8px 12px; }
            .material-filters button { font-size: 14px; padding: 8px 12px; }
            #embarqueSummary { grid-template-columns: 1fr; }
        }

        .user-selection-container {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            text-align: center;
        }

        .user-selection-box {
            width: 100%;
            max-width: 450px;
            animation: fadeIn 0.7s ease-out;
        }

        .user-selection-box h2 {
            margin: 20px 0 30px;
            font-size: 22px;
            font-weight: 500;
            color: var(--dark-gray);
        }

        .logo {
            width: 195px;
            height: 160px;
            margin-bottom: 20px;
        }

        .user-option {
            background-color: var(--white);
            border: 1px solid var(--medium-gray);
            border-radius: var(--border-radius-medium);
            padding: 25px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .user-option:hover, .user-option.selected {
            border-color: var(--primary-blue);
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.15);
            transform: translateY(-3px);
        }

        .user-option .icon {
            width: 45px;
            height: 45px;
        }

        .user-option .text-content {
            text-align: left;
        }

        .user-option h3 {
            font-size: 18px;
            margin: 0 0 5px;
            color: var(--primary-blue);
            font-weight: 600;
        }

        .user-option p {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.4;
            margin: 0;
        }

        .user-option-button {
            width: 100%;
            padding: 14px;
            margin-top: 30px;
            background-color: var(--primary-blue);
            color: var(--white);
            border: none;
            border-radius: var(--border-radius-small);
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3);
        }

        .user-option-button:hover {
            background-color: var(--dark-blue);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 123, 255, 0.4);
        }

        .driver-item-list {
            list-style: none;
            padding: 0;
            margin-top: 15px;
        }
        .driver-item-list li {
            background-color: var(--medium-gray);
            padding: 10px 15px;
            border-radius: var(--border-radius-small);
            margin-bottom: 8px;
            font-size: 16px;
            font-weight: 500;
            color: var(--dark-gray);
        }
    </style>
</head>
<body>
<div class="user-selection-container" id="userSelectionPage">
    <div class="user-selection-box">
        <img src="c-high-resolution-logo.png" alt="Logo" class="logo">
        <h2>Qual serviço você executa?</h2>

        <div class="user-option" data-user-type="operador" onclick="selectUserType('operador')">
            <img src="pacote.png" alt="Icone Operador" class="icon">
            <div class="text-content">
                <h3>Operador</h3>
                <p>Separar materiais e inserir pesos solicitados</p>
            </div>
        </div>

        <div class="user-option" data-user-type="motorista" onclick="selectUserType('motorista')">
            <img src="caminhao.png" alt="Icone Motorista" class="icon">
            <div class="text-content">
                <h3>Motorista</h3>
                <p>Coletar pedidos e entregar nos locais solicitados</p>
            </div>
        </div>

        <button class="user-option-button" onclick="continueToNextScreen()">Continuar</button>
    </div>
</div>

<div class="user-selection-container" id="materialSelectionPage" style="display: none;">
    <div class="user-selection-box">
        <img src="c-high-resolution-logo.png" alt="Logo" class="logo">
        <h2>Qual material você irá separar?</h2>

        <div class="user-option" data-material-type="Chapa" onclick="selectMaterialType('Chapa')">
            <img src="chapa-de-aco (1).png" alt="Icone Chapa" class="icon">
            <div class="text-content">
                <h3>Chapa</h3>
                <p>Pedidos contendo chapas</p>
            </div>
        </div>

        <div class="user-option" data-material-type="Tubo" onclick="selectMaterialType('Tubo')">
            <img src="tubos.png" alt="Icone Tubo" class="icon">
            <div class="text-content">
                <h3>Tubo</h3>
                <p>Pedidos contendo tubos</p>
            </div>
        </div>

        <div class="user-option" data-material-type="Viga" onclick="selectMaterialType('Viga')">
            <img src="viga-de-aco.png" alt="Icone Viga" class="icon">
            <div class="text-content">
                <h3>Viga</h3>
                <p>Pedidos contendo vigas</p>
            </div>
        </div>

        <div class="user-option" data-material-type="Todos" onclick="selectMaterialType('Todos')">
            <img src="aco-laminado.png" alt="Icone Todos" class="icon">
            <div class="text-content">
                <h3>Todos os Materiais</h3>
                <p>Visualizar pedidos de todos os tipos de materiais</p>
            </div>

        </div>

        <button class="user-option-button" onclick="continueToFilterScreen()">Continuar</button>

    </div>
</div>


<div class="login-container" id="loginPage" style="display: none;">
    <div class="login-box">
        <h2>Acesso de Operador</h2>
        <input type="text" id="username" placeholder="Usuário" autocomplete="username" />
        <input type="password" id="password" placeholder="Senha" autocomplete="current-password" />
        <button onclick="fazerLogin()">Acessar Sistema</button>
        <div class="login-error" id="loginErro"></div>
    </div>
</div>

<div class="login-container" id="driverLoginPage" style="display: none;">
    <div class="login-box">
        <h2>Acesso de Motorista</h2>
        <input type="text" id="driverUsername" placeholder="Usuário" autocomplete="username" />
        <input type="password" id="driverPassword" placeholder="Senha" autocomplete="current-password" />
        <button onclick="fazerLoginMotorista()">Acessar Sistema</button>
        <div class="login-error" id="driverLoginErro"></div>
    </div>
</div>

<div class="filter-screen-container" id="filterScreen">
    <div class="filter-box">
        <img src="c-high-resolution-logo.png" alt="Logo" class="logo">
        <h2>Visualizar Pedidos</h2>
        <div class="summary-section">
            <h3>Resumo de Pedidos por Embarque</h3>
            <div id="embarqueSummary"></div>
            <button onclick="viewPedidosFromSummary('')" class="filter-box-button-bottom">Ver Todos os Pedidos</button>
        </div>    

        <button class="filter-box-button-bottom" onclick="confirmResetAllData()" id="resetDataButton" style="background-color: var(--red-error); margin-top: 30px; display: block;">Zerar Todos os Dados de Pesagem</button>

        <button class="filter-box-button-bottom" onclick="logout()" style="background-color: var(--text-secondary); margin-top: 15px;">Sair (Logout)</button>
    
    </div>
</div>

<div id="mainApp">
    <div class="header">
        <div class="header-left">
            <button class="btn-back" onclick="goBackToFilterScreen()">Voltar</button>
            <div class="title">Gestão de Pedidos</div>
        </div>
        <button class="btn-logout" onclick="logout()">Sair</button>
    </div>
    <div class="container">
        <div class="welcome" id="welcomeMessage"></div>

        <div class="main-app-status-filters" id="mainAppStatusFilters" style="display:none;">
            <button data-status-filter="todas" class="active" onclick="aplicarFiltroStatusPrincipal('todas', this)">Todos os Status</button>
            <button data-status-filter="Aguardando separação" onclick="aplicarFiltroStatusPrincipal('Aguardando separação', this)">Aguardando Separação</button>
            <button data-status-filter="Em separação" onclick="aplicarFiltroStatusPrincipal('Em separação', this)">Em Separação</button>
            <button data-status-filter="Pedido separado" onclick="aplicarFiltroStatusPrincipal('Pedido separado', this)">Pedido Separado</button>
        </div>


        <div id="quotationsByEmbarque" class="card quotations-section" style="display:none;">
            <h3>Cotações Relacionadas ao Embarque</h3>
            <div id="quotationList"></div>
        </div>

        <div id="pedidosPorSetor" class="card"></div>
        <button id="backToAllOrdersButton" class="btn-back-to-all-orders" style="display:none; margin-top: 25px; width: 100%;">Voltar para Todos os Pedidos</button>

</div>
    </div>
</div>

<div class="modal-overlay" id="modalOverlay">
    <div class="modal-content">
        <button class="modal-close-button" onclick="closeModal()">&times;</button>
        <h3 id="modalTitle"></h3>
        <p id="modalMessage"></p>
        <div class="modal-buttons" id="modalButtons">
    </div>
</div>

<script>
    const usuarios = {
        "admin": "1234",
        "operador1": "1234",
        "operador2": "1234",
        "operador3": "1234",
        "motorista1": "1234",
        "motorista2": "1234",
        "motorista3": "1234",
        "joao": "1234"
    };

    let pedidos = [
        { id: 10532, cliente: "Metalúrgica Central", status: "Aguardando separação", endereco: "Rua teste, 123 - Serra, ES", embarque: "#25689", motorista: "motorista1", produtos: { Chapa: ["CHAPA 1/8", "CHAPA GALVANIZADA", "CHAPA INOX 304"], Tubo: ["TUBO RETANGULAR 40x20", "TUBO REDONDO 1 1/2", "TUBO QUADRADO 20x20"], Viga: ["VIGA U 1/4", "VIGA I 200"] } },
        { id: 10533, cliente: "Construtora Brasil", status: "Aguardando separação", endereco: "Av. Exemplo, 456 - Vila Velha, ES", embarque: "#25690", motorista: "motorista2", produtos: { Chapa: ["CHAPA 3/16", "CHAPA XADREZ 1/4"], Tubo: ["TUBO REDONDO 2", "TUBO SCHEDULE 40"] } },
        { id: 10534, cliente: "Ferro e Aço LTDA", status: "Aguardando separação", endereco: "Rua das Indústrias, 1010 - Cariacica, ES", embarque: "#25691", motorista: "motorista1", produtos: { Viga: ["VIGA W 2", "VIGA H 150"], Chapa: ["CHAPA XADREZ 5/16", "CHAPA LISA 1/2"], Tubo: ["TUBO QUADRADO 50x50", "TUBO REDONDO 3"] } },
        { id: 10535, cliente: "ConstruAço", status: "Aguardando separação", endereco: "Rodovia Norte-Sul, 999 - Serra, ES", embarque: "#25689", motorista: "motorista2", produtos: { Tubo: ["TUBO QUADRADO 50x50", "TUBO RETANGULAR 60x40", "TUBO CONDUITE 3/4"], Viga: ["VIGA H 200", "VIGA U 5", "VIGA LAMINADA 150"] } },
        { id: 10536, cliente: "Montagens Gerais", status: "Aguardando separação", endereco: "Rua Projetada, 789 - Serra, ES", embarque: "#25689", motorista: "motorista3", produtos: { Chapa: ["CHAPA PRETA 1/4", "CHAPA FINO QUENTE 1/8", "CHAPA DE PISO ALUMÍNIO"], Tubo: ["TUBO INDUSTRIAL 3", "TUBO INOX SANITÁRIO"], Viga: ["VIGA I 300", "VIGA SOLDADA 250", "VIGA LAMINADA 200"] } },
        { id: 10537, cliente: "Aço Forte", status: "Aguardando separação", endereco: "Av. Atlântica, 321 - Vila Velha, ES", embarque: "#25690", motorista: "motorista1", produtos: { Chapa: ["CHAPA ALUMÍNIO 2mm", "CHAPA GALVANIZADA TRAPEZOIDAL"], Viga: ["VIGA SOLDADA 600", "VIGA WIDE FLANGE 800"] } },
        { id: 10538, cliente: "Metal Capixaba", status: "Aguardando separação", endereco: "Rua dos Ferroviários, 12 - Vitória, ES", embarque: "#25692", motorista: "motorista2", produtos: { Tubo: ["TUBO ZINCADO 1", "TUBO ESTRUTURAL 100x100"], Viga: ["VIGA SOLDADA 200", "VIGA I 150"] } },
        { id: 10539, cliente: "Engemetal", status: "Aguardando separação", endereco: "Rua Industrial, 88 - Linhares, ES", embarque: "#25693", motorista: "motorista3", produtos: { Chapa: ["CHAPA LISA 1/2", "CHAPA CORTEN 3mm"], Tubo: ["TUBO REDONDO 3", "TUBO ELETRODUTO 1"] } },
        { id: 10540, cliente: "Ferroleste", status: "Aguardando separação", endereco: "Avenida Norte, 999 - Colatina, ES", embarque: "#25694", motorista: "motorista1", produtos: { Viga: ["VIGA U 5", "VIGA METÁLICA TRELIÇADA"], Chapa: ["CHAPA ANTIDERRAPANTE", "CHAPA EXPANDIDA ALUMÍNIO"] } },
        { id: 10541, cliente: "Metalúrgica União", status: "Aguardando separação", endereco: "Rod. do Contorno, 400 - Vila Velha, ES", embarque: "#25690", motorista: "motorista2", produtos: { Tubo: ["TUBO QUADRADO 40x40", "TUBO RETANGULAR 80x40", "TUBO DE CONDUÇÃO 2"], Chapa: ["CHAPA GALVANIZADA", "CHAPA PERFURADA 3mm"] } },
        { id: 10542, cliente: "Construmetais", status: "Aguardando separação", endereco: "Rua das Oficinas, 77 - Serra, ES", embarque: "#25689", motorista: "motorista3", produtos: { Viga: ["VIGA I 250", "VIGA U 6"], Chapa: ["CHAPA LISA 3/8", "CHAPA DE AÇO CARBONO", "CHAPA DE LIGA LEVE"] } },
        { id: 10543, cliente: "Alfa Engenharia", status: "Aguardando separação", endereco: "Rua das Palmeiras, 10 - Cariacica, ES", embarque: "#25691", motorista: "motorista1", produtos: { Tubo: ["TUBO REDONDO 1 1/2", "TUBO DE PRECISÃO", "TUBO OVAL"], Chapa: ["CHAPA EXPANDIDA", "CHAPA DE LATÃO"] } },
        { id: 10544, cliente: "Beta Construções", status: "Aguardando separação", endereco: "Av. Beira Mar, 2000 - Vitória, ES", embarque: "#25692", motorista: "motorista2", produtos: { Viga: ["VIGA U 3", "VIGA DE ALUMÍNIO"], Chapa: ["CHAPA LISA 1/4", "CHAPA DE CHUMBO"] } },
        { id: 10545, cliente: "Gama Ferragens", status: "Aguardando separação", endereco: "Rua do Comércio, 50 - Linhares, ES", embarque: "#25693", motorista: "motorista3", produtos: { Chapa: ["CHAPA GALVANIZADA", "CHAPA FRISADA"], Tubo: ["TUBO RETANGULAR 20x10", "TUBO INDUSTRIAL 4", "TUBO COM COSTURA"] } },
        { id: 10546, cliente: "Delta Estruturas", status: "Aguardando separação", endereco: "BR-101 Sul, KM 25 - Serra, ES", embarque: "#25689", motorista: "motorista1", produtos: { Viga: ["VIGA H 150", "VIGA I 100"], Chapa: ["CHAPA PRETA 3/16", "CHAPA GROSSA 1/2"] } },
        { id: 10547, cliente: "Épsilon Indústria", status: "Aguardando separação", endereco: "Av. Central, 300 - Vila Velha, ES", embarque: "#25690", motorista: "motorista2", produtos: { Tubo: ["TUBO REDONDO 3/4", "TUBO DE COBRE 1/2"], Chapa: ["CHAPA INOX 1mm", "CHAPA ESCOVADA"] } },
        { id: 10548, cliente: "Zeta Metalúrgica", status: "Aguardando separação", endereco: "Rua Norte, 15 - Colatina, ES", embarque: "#25694", motorista: "motorista3", produtos: { Viga: ["VIGA I 100", "VIGA W 3"], Tubo: ["TUBO QUADRADO 30x30", "TUBO RETANGULAR 50x25"] } },
        { id: 10549, cliente: "Ômega Comércio", status: "Aguardando separação", endereco: "Praça da Matriz, 7 - Serra, ES", embarque: "#25689", motorista: "motorista1", produtos: { Chapa: ["CHAPA PERFURADA", "CHAPA DE ZINCO"], Viga: ["VIGA SOLDADA 400", "VIGA DE TRELIÇA"] } },
        { id: 10550, cliente: "Ícaro Soldas", status: "Aguardando separação", endereco: "Rua da Paz, 123 - Cariacica, ES", embarque: "#25691", motorista: "motorista2", produtos: { Tubo: ["TUBO INDUSTRIAL 2", "TUBO REDONDO 5"], Chapa: ["CHAPA FINA FRIA", "CHAPA CROMADA"] } },
        { id: 10551, cliente: "Fênix Construções", status: "Aguardando separação", endereco: "Av. da República, 500 - Vitória, ES", embarque: "#25692", motorista: "motorista3", produtos: { Viga: ["VIGA W 4", "VIGA PRÉ-MOLDADA"], Tubo: ["TUBO PVC 100mm", "TUBO ESGOTO 150mm"] } },
        { id: 10552, cliente: "Grifo Metais", status: "Aguardando separação", endereco: "Rua do Sol, 888 - Linhares, ES", embarque: "#25693", motorista: "motorista1", produtos: { Chapa: ["CHAPA POLICARBONATO", "CHAPA ACRÍLICA"], Viga: ["VIGA LAMINADA 200", "VIGA DE CONCRETO PRÉ-FABRICADO"] } },
        { id: 10553, cliente: "Draco Montagens", status: "Aguardando separação", endereco: "Rodovia do Café, KM 5 - Serra, ES", embarque: "#25689", motorista: "motorista2", produtos: { Tubo: ["TUBO OBLONGO", "TUBO DE VENTILAÇÃO"], Chapa: ["CHAPA GALVANIZADA", "CHAPA DE COBRE"] } },
        { id: 10554, cliente: "Pegasus Engenharia", status: "Aguardando separação", endereco: "Rua das Rosas, 77 - Vila Velha, ES", embarque: "#25690", motorista: "motorista3", produtos: { Viga: ["VIGA CAIXÃO", "VIGA DE MADEIRA LAMINADA"], Tubo: ["TUBO DE AÇO INOX", "TUBO DE ALUMÍNIO"] } },
        { id: 10555, cliente: "Centauro Indústria", status: "Aguardando separação", endereco: "Av. Brasil, 1100 - Colatina, ES", embarque: "#25694", motorista: "motorista1", produtos: { Chapa: ["CHAPA DE COBRE", "CHAPA DE BRONZE"], Viga: ["VIGA U 8", "VIGA H 250"] } },
        { id: 10556, cliente: "Harpia Estruturas", status: "Aguardando separação", endereco: "Rua da Serra, 45 - Serra, ES", embarque: "#25689", motorista: "motorista2", produtos: { Tubo: ["TUBO SCH 40", "TUBO DE FERRO FUNDIDO"], Chapa: ["CHAPA GROSSA", "CHAPA DE TITÂNIO"] } },
        { id: 10557, cliente: "Minotauro Construções", status: "Aguardando separação", endereco: "Estrada Velha, 22 - Cariacica, ES", embarque: "#25691", motorista: "motorista3", produtos: { Viga: ["VIGA I 400", "VIGA WIDE FLANGE 600"], Tubo: ["TUBO SEM COSTURA", "TUBO COM FLANGE"] } },
        { id: 10558, cliente: "Sereia Naval", status: "Aguardando separação", endereco: "Rua do Porto, 33 - Vitória, ES", embarque: "#25692", motorista: "motorista1", produtos: { Chapa: ["CHAPA NAVAL", "CHAPA DE AÇO MARÍTIMO"], Viga: ["VIGA CAIXÃO GRANDE", "VIGA GERAL"] } },
        { id: 10559, cliente: "Tritão Ferro e Aço", status: "Aguardando separação", endereco: "Av. dos Navegantes, 150 - Linhares, ES", embarque: "#25693", motorista: "motorista2", produtos: { Tubo: ["TUBO QUADRADO 100x100", "TUBO RETANGULAR 120x60"], Chapa: ["CHAPA DE PISO", "CHAPA ANTI-ABRASIVA"] } },
        { id: 10560, cliente: "Atlas Construções", status: "Aguardando separação", endereco: "Rua Principal, 55 - Serra, ES", embarque: "#25689", motorista: "motorista3", produtos: { Viga: ["VIGA H 300", "VIGA DE PONTE"], Chapa: ["CHAPA CORTEN", "CHAPA DE PAREDE"] } },
        { id: 10561, cliente: "Titã Fundições", status: "Aguardando separação", endereco: "Rodovia das Árvores, 99 - Vila Velha, ES", embarque: "#25690", motorista: "motorista1", produtos: { Chapa: ["CHAPA DE BRONZE", "CHAPA DE LIGA METÁLICA"], Tubo: ["TUBO FUNDIDO", "TUBO DE CONCRETO"] } },
        { id: 10562, cliente: "Olimpo Metais", status: "Aguardando separação", endereco: "Av. do Contorno, 1001 - Colatina, ES", embarque: "#25694", motorista: "motorista2", produtos: { Viga: ["VIGA LAMINADA 300", "VIGA ARMADA"], Chapa: ["CHAPA DE CHUMBO", "CHAPA DE ALUMÍNIO COMPOSTO"] } },
        { id: 10563, cliente: "União Metálica", status: "Aguardando separação", endereco: "Rua das Flores, 45 - Serra, ES", embarque: "#25689", motorista: "motorista3", produtos: { Chapa: ["CHAPA PRETA 1/2", "CHAPA GALVANIZADA 2mm"], Tubo: ["TUBO REDONDO 4", "TUBO QUADRADO 70x70"], Viga: ["VIGA I 350", "VIGA U 10"] } },
        { id: 10564, cliente: "Expresso Cargas", status: "Aguardando separação", endereco: "BR-101 Norte, KM 50 - Aracruz, ES", embarque: "#25695", motorista: "motorista1", produtos: { Tubo: ["TUBO RETANGULAR 50x30", "TUBO ZINCADO 2"], Viga: ["VIGA H 220", "VIGA LAMINADA 250"] } },
        { id: 10565, cliente: "Soluções em Aço", status: "Aguardando separação", endereco: "Rua do Progresso, 200 - Guarapari, ES", embarque: "#25696", motorista: "motorista2", produtos: { Chapa: ["CHAPA INOX 430", "CHAPA XADREZ 3/8"], Viga: ["VIGA CAIXÃO PEQUENA"] } },
        { id: 10566, cliente: "Estrutura Forte", status: "Aguardando separação", endereco: "Av. das Américas, 100 - Linhares, ES", embarque: "#25693", motorista: "motorista3", produtos: { Tubo: ["TUBO REDONDO 1", "TUBO INDUSTRIAL 5"], Chapa: ["CHAPA PRETA 1/8"] } },
        { id: 10567, cliente: "Cia. do Metal", status: "Aguardando separação", endereco: "Rua das Acácias, 10 - São Mateus, ES", embarque: "#25697", motorista: "motorista1", produtos: { Viga: ["VIGA U 4", "VIGA I 120"], Chapa: ["CHAPA GALVANIZADA 1mm"] } },
        { id: 10568, cliente: "Norte Aço", status: "Aguardando separação", endereco: "Rodovia ES-010, KM 5 - Fundão, ES", embarque: "#25698", motorista: "motorista2", produtos: { Tubo: ["TUBO QUADRADO 60x60"], Chapa: ["CHAPA FINA FRIA 0.5mm", "CHAPA DE BRONZE"] } },
        { id: 10569, cliente: "Leste Ferro", status: "Aguardando separação", endereco: "Rua Central, 30 - Cachoeiro de Itapemirim, ES", embarque: "#25699", motorista: "motorista3", produtos: { Viga: ["VIGA H 100"], Chapa: ["CHAPA ANTIDERRAPANTE 3mm"] } },
        { id: 10570, cliente: "Centro Metal", status: "Aguardando separação", endereco: "Av. Getúlio Vargas, 15 - Castelo, ES", embarque: "#25700", motorista: "motorista1", produtos: { Tubo: ["TUBO REDONDO 2 1/2", "TUBO ESTRUTURAL 80x80"], Chapa: ["CHAPA LISA 1/8", "CHAPA PERFURADA 5mm"] } },
        { id: 10571, cliente: "Metalúrgica do Aço", status: "Aguardando separação", endereco: "Rua do Sol, 10 - Serra, ES", embarque: "#25689", motorista: "motorista2", produtos: { Chapa: ["CHAPA 1/4", "CHAPA INOX 316"], Viga: ["VIGA I 100"] } },
        { id: 10572, cliente: "Construções Modernas", status: "Aguardando separação", endereco: "Av. da Praia, 50 - Vila Velha, ES", embarque: "#25690", motorista: "motorista3", produtos: { Tubo: ["TUBO REDONDO 1", "TUBO INDUSTRIAL 2"], Chapa: ["CHAPA GALVANIZADA 3mm"] } },
        { id: 10573, cliente: "Estruturas Metálicas", status: "Aguardando separação", endereco: "Rua da Paz, 200 - Cariacica, ES", embarque: "#25691", motorista: "motorista1", produtos: { Viga: ["VIGA U 6", "VIGA H 200"], Tubo: ["TUBO QUADRADO 30x30"] } },
        { id: 10574, cliente: "Galvanização Brasil", status: "Aguardando separação", endereco: "Rodovia do Ferro, 700 - Linhares, ES", embarque: "#25693", motorista: "motorista2", produtos: { Chapa: ["CHAPA GALVANIZADA 1/2"], Tubo: ["TUBO RETANGULAR 40x20"] } },
        { id: 10575, cliente: "Tubos e Conexões", status: "Aguardando separação", endereco: "Rua do Comércio, 120 - Colatina, ES", embarque: "#25694", motorista: "motorista3", produtos: { Tubo: ["TUBO REDONDO 2", "TUBO SCHEDULE 80"], Viga: ["VIGA I 200"] } }
    ];

    let usuarioLogado = null;
    let isMotoristaLogado = false;

    const localStorageDadosPesoKey = "dadosPesagemGlobal";
    const localStorageCertificadoKey = "dadosCertificadoGlobal";
    const localStorageSetorEnviadoKey = "pedidoEnviadoPorSetor";
    const localStoragePedidoStatusKey = "pedidoStatus";

    let globalFiltroPedido = "";
    let globalFiltroRota = "todas";
    let globalFiltroStatus = "todas";
    let pedidoUnicoVisualizado = null;

    let previousGlobalFiltroRota = "todas";
    let previousGlobalFiltroStatus = "todas";


    let globalFiltroMaterial = "Todos";


    function getPedidoStatus(id) {
        return localStorage.getItem(`${localStoragePedidoStatusKey}_${id}`) ||
                (pedidos.find(p => p.id === id) ? pedidos.find(p => p.id === id).status : "Aguardando separação");
    }

    function setPedidoStatus(id, status) {
        localStorage.setItem(`${localStoragePedidoStatusKey}_${id}`, status);

        const pedidoIndex = pedidos.findIndex(p => p.id === id);
        if (pedidoIndex !== -1) {
            pedidos[pedidoIndex].status = status;
        }

        if (document.getElementById("filterScreen").style.display === "flex") {
            exibirResumoEmbarques();
        }
        if (document.getElementById("mainApp").style.display === "block") {
            renderizarPedidosPorSetor(pedidoUnicoVisualizado);
            exibirCotasPorEmbarque(pedidoUnicoVisualizado);
        }
    }

    function getDadosPesoPedido(id) {
        return JSON.parse(localStorage.getItem(`${localStorageDadosPesoKey}_${id}`)) || {};
    }

    function setDadosPesoPedido(id, dados) {
        localStorage.setItem(`${localStorageDadosPesoKey}_${id}`, JSON.stringify(dados));
    }

    function getDadosCertificadoPedido(id) {
        return JSON.parse(localStorage.getItem(`${localStorageCertificadoKey}_${id}`)) || {};
    }

    function setDadosCertificadoPedido(id, dados) {
        localStorage.setItem(`${localStorageCertificadoKey}_${id}`, JSON.stringify(dados));
    }


    function isSetorEnviado(id, setor) {
        return localStorage.getItem(`${localStorageSetorEnviadoKey}_${id}_${setor.toLowerCase()}`) === "true";
    }

    function setSetorEnviado(id, setor) {
        localStorage.setItem(`${localStorageSetorEnviadoKey}_${id}_${setor.toLowerCase()}`, "true");
    }

    function verificarTodosSetoresEnviados(pedidoId) {
        const pedido = pedidos.find(p => p.id === pedidoId);
        if (!pedido) {
            return false;
        }

        for (const setor in pedido.produtos) {
            if (Object.prototype.hasOwnProperty.call(pedido.produtos, setor)) {
                if (!isSetorEnviado(pedidoId, setor)) {
                    return false;
                }
            }
        }
        return true;
    }


    function showUserSelectionPage() {
        document.getElementById("userSelectionPage").style.display = "flex";
        document.getElementById("loginPage").style.display = "none";
        document.getElementById("driverLoginPage").style.display = "none";
        document.getElementById("filterScreen").style.display = "none";
        document.getElementById("mainApp").style.display = "none";
        document.getElementById("materialSelectionPage").style.display = "flex"; 
        isMotoristaLogado = false;
        selectedUserType = null;
    }

let selectedUserType = null;
let selectedMaterialType = null;


function selectUserType(type) {
    selectedUserType = type;
    document.querySelectorAll('#userSelectionPage .user-option').forEach(option => {
        option.classList.remove('selected');
    });
    document.querySelector(`#userSelectionPage .user-option[data-user-type="${type}"]`).classList.add('selected');
}


function continueToNextScreen() {
    if (selectedUserType === 'operador') {
        showOperatorLoginPage();
    } else if (selectedUserType === 'motorista') {
        showDriverLoginPage();
    } else {
        alert("Por favor, selecione seu tipo de serviço para continuar.");
    }
}


function showUserSelectionPage() {
    hideAllScreens();
    document.getElementById("userSelectionPage").style.display = "flex";
}

function showOperatorLoginPage() {
    hideAllScreens();
    document.getElementById("loginPage").style.display = "flex";
}

function showDriverLoginPage() {
    hideAllScreens();
    document.getElementById("driverLoginPage").style.display = "flex";
}

function showMaterialSelectionPage() {
    hideAllScreens();
    document.getElementById("materialSelectionPage").style.display = "flex";
    selectedMaterialType = null;
    document.querySelectorAll('#materialSelectionPage .user-option').forEach(option => {
        option.classList.remove('selected');
    });
}

function showFilterScreen() {
    hideAllScreens();
    document.getElementById("filterScreen").style.display = "block";
}

function showMainApp() {
    hideAllScreens();
    document.getElementById("mainApp").style.display = "block";
}

function hideAllScreens() {
    document.getElementById("userSelectionPage").style.display = "none";
    document.getElementById("loginPage").style.display = "none";
    document.getElementById("driverLoginPage").style.display = "none";
    document.getElementById("filterScreen").style.display = "none";
    document.getElementById("mainApp").style.display = "none";
    document.getElementById("materialSelectionPage").style.display = "none";
}

    function fazerLogin() {
        const user = document.getElementById("username").value.trim();
        const pass = document.getElementById("password").value.trim();
        const erro = document.getElementById("loginErro");

        const userIsOperator = ["admin", "operador1", "operador2", "operador3", "joao"].includes(user);

        if (usuarios[user] && usuarios[user] === pass && userIsOperator) {
            usuarioLogado = user;
            isMotoristaLogado = false;
            document.getElementById("loginPage").style.display = "none";
            
            if (usuarioLogado === "admin") {
                document.getElementById("resetDataButton").style.display = "block";
            } else {
                document.getElementById("resetDataButton").style.display = "none";
            }
            
            exibirResumoEmbarques();
            showFilterScreen();
            showMaterialSelectionPage(); 
        } else {
            erro.textContent = "Usuário ou senha incorretos ou não é um operador.";
        }
    }
    



    function fazerLoginMotorista() {
        const user = document.getElementById("driverUsername").value.trim();
        const pass = document.getElementById("driverPassword").value.trim();
        const erro = document.getElementById("driverLoginErro");

        const userIsDriver = ["motorista1", "motorista2", "motorista3"].includes(user);

        if (usuarios[user] && usuarios[user] === pass && userIsDriver) {
            usuarioLogado = user;
            isMotoristaLogado = true;
            document.getElementById("driverLoginPage").style.display = "none";
            document.getElementById("resetDataButton").style.display = "none";
            exibirResumoEmbarques();
            showFilterScreen(); 
        } else {
            erro.textContent = "Usuário ou senha incorretos ou não é um motorista.";
        }
    }
        showMainApp();  


    function selectMaterialType(type) {
    selectedMaterialType = type;
    document.querySelectorAll('#materialSelectionPage .user-option').forEach(option => {
        option.classList.remove('selected');
    });
    document.querySelector(`#materialSelectionPage .user-option[data-material-type="${type}"]`).classList.add('selected');
    }

    function continueToFilterScreen() {
      if (!selectedMaterialType) {
            showModal("Atenção", "Por favor, selecione um tipo de material para continuar.", `<button class="modal-button ok" onclick="closeModal()">OK</button>`);
            return;
        }
        globalFiltroMaterial = selectedMaterialType; 
        document.getElementById("materialSelectionPage").style.display = "none";
        showFilterScreen(); 
    }


    window.onload = showUserSelectionPage;

    function showMainAppScreen() {
        document.getElementById("filterScreen").style.display = "none";
        document.getElementById("mainApp").style.display = "block";
        document.getElementById("welcomeMessage").textContent = `Bem-vindo, ${usuarioLogado}!`;
        document.getElementById("mainAppStatusFilters").style.display = isMotoristaLogado ? "none" : "flex";
        document.getElementById("backToAllOrdersButton").style.display = (pedidoUnicoVisualizado !== null) ? "block" : "none";
        

        renderizarPedidosPorSetor(pedidoUnicoVisualizado);
        exibirCotasPorEmbarque(pedidoUnicoVisualizado);

        const statusButtons = document.querySelectorAll('#mainAppStatusFilters button');
        statusButtons.forEach(button => {
            if (button.dataset.statusFilter === globalFiltroStatus) { 
                button.classList.add('active');
            } else {
                button.classList.remove('active');
            }
        });
        
    }

    function showFilterScreen() {
        document.getElementById("mainApp").style.display = "none";
        document.getElementById("filterScreen").style.display = "flex";
        exibirResumoEmbarques();
        document.getElementById("backToAllOrdersButton").style.display = "none";
        document.getElementById("quotationsByEmbarque").style.display = "none";

        const summaryTitle = document.querySelector("#filterScreen h2");
        summaryTitle.textContent = isMotoristaLogado ? `Olá, ${usuarioLogado.toUpperCase()}!` : "Visualizar Pedidos";
    }

    function logout() {
        usuarioLogado = null;
        selectedUserType = null;
        isMotoristaLogado = false;
        globalFiltroPedido = "";
        globalFiltroRota = "todas";
        globalFiltroStatus = "todas";
        globalFiltroMaterial = "Todos"; 
        selectedMaterialType = null; 
        pedidoUnicoVisualizado = null;
        document.getElementById("username").value = "";
        document.getElementById("password").value = "";
        document.getElementById("loginErro").textContent = "";
        document.getElementById("driverUsername").value = "";
        document.getElementById("driverPassword").value = "";
        document.getElementById("driverLoginErro").textContent = "";
        showUserSelectionPage();
    }


    function renderizarPedidosPorSetor(idPedidoEspecifico = null) {
        const pedidosPorSetorDiv = document.getElementById("pedidosPorSetor");
        pedidosPorSetorDiv.innerHTML = "";

        let pedidosFiltrados = pedidos.filter(pedido => {
            const statusCorresponde = globalFiltroStatus === "todas" || getPedidoStatus(pedido.id) === globalFiltroStatus;
            const rotaCorresponde = globalFiltroRota === "todas" || pedido.embarque === globalFiltroRota;
            const pedidoCorresponde = !idPedidoEspecifico || pedido.id === idPedidoEspecifico;

            const pertenceAoMotorista = isMotoristaLogado ? pedido.motorista === usuarioLogado : true;
            const pertenceAoOperador = !isMotoristaLogado && ["admin", "operador1", "operador2", "operador3", "joao"].includes(usuarioLogado.toLowerCase());

            const materialCorresponde = globalFiltroMaterial === "Todos" || 
                (globalFiltroMaterial === "Chapa" && pedido.produtos["Chapa"]) ||
                (globalFiltroMaterial === "Viga" && pedido.produtos["Viga"]) || 
                (globalFiltroMaterial === "Tubo" && pedido.produtos["Tubo"]);

            return statusCorresponde && rotaCorresponde && pedidoCorresponde && (isMotoristaLogado ? pertenceAoMotorista : pertenceAoOperador) && materialCorresponde;
        });

        if (pedidosFiltrados.length === 0) {
            pedidosPorSetorDiv.innerHTML = "<p style='text-align: center; color: var(--text-secondary); padding: 20px;'>Nenhum pedido encontrado com os filtros aplicados.</p>";
            return;
        }

        pedidosFiltrados.forEach(pedido => {
            const statusAtual = getPedidoStatus(pedido.id);
            const isPedidoSeparado = statusAtual === "Pedido separado";

            let statusClass;
            if (statusAtual === "Aguardando separação") {
                statusClass = "status-aguardando-separacao";
            } else if (statusAtual === "Em separação") {
                statusClass = "status-em-separacao";
            } else if (statusAtual === "Pedido separado") {
                statusClass = "status-pedido-separado";
            } else {
                statusClass = "";
            }

            const pedidoCard = document.createElement("div");
            pedidoCard.classList.add("card");
            pedidoCard.setAttribute("data-pedido-id", pedido.id);
            pedidoCard.innerHTML = `
                <div class="pedido-header">
                    <h3>COT_${pedido.id} - ${pedido.cliente}</h3>
                    <p>Endereço: ${pedido.endereco}</p>
                    <p>Embarque: ${pedido.embarque}</p>
                    <p class="status-pedido ${statusClass}">Status: ${statusAtual}</p>
                </div>
            `;

            const sortedSectors = Object.keys(pedido.produtos).sort();

            if (isMotoristaLogado) {
                const setorDiv = document.createElement("div");
                setorDiv.innerHTML = `<h4>Itens do Pedido:</h4>`;
                const itemList = document.createElement("ul");
                itemList.classList.add("driver-item-list");

                sortedSectors.forEach(setor => {
                    if (globalFiltroMaterial !== "Todos" && setor !== globalFiltroMaterial) {
                        return;
                    }
                    pedido.produtos[setor].forEach(produto => {
                        const item = document.createElement("li");
                        item.textContent = produto;
                        itemList.appendChild(item);
                    });
                });
                setorDiv.appendChild(itemList);
                pedidoCard.appendChild(setorDiv);

            } else {
                const isAdmin = usuarioLogado.toLowerCase() === "admin";
                sortedSectors.forEach(setor => {
                    const isUserSetor = usuarioLogado.toLowerCase() === setor.toLowerCase();
                    const isSetorAlreadySent = isSetorEnviado(pedido.id, setor);

                    if (globalFiltroMaterial !== "Todos" && setor !== globalFiltroMaterial) {
                        return;
                    }

                    const userCanViewSetor = true;
                    
                    if (!userCanViewSetor) {
                        return;
                    }

                    const setorDiv = document.createElement("div");
                    setorDiv.innerHTML = `<h4>Setor: ${setor}</h4>`;

                    pedido.produtos[setor].forEach(produto => {
                        const peso = getDadosPesoPedido(pedido.id)[produto] !== undefined ? getDadosPesoPedido(pedido.id)[produto] : '';
                        const certificado = getDadosCertificadoPedido(pedido.id)[produto] !== undefined ? getDadosCertificadoPedido(pedido.id)[produto] : '';
                        setorDiv.innerHTML += `
                            <div class="item">
                                <span>${produto}:</span>
                                <div>
                                    <input
                                        type="number"
                                        step="5"
                                        placeholder="Peso (kg)*"
                                        value="${peso}"
                                        id="peso-${pedido.id}-${setor}-${produto.replace(/\s/g, '-')}"
                                        ${isPedidoSeparado || isSetorAlreadySent || statusAtual !== "Em separação" ? 'disabled' : ''}
                                    />
                                    <input
                                        type="text"
                                        placeholder="Certificado*"
                                        value="${certificado}"
                                        id="certificado-${pedido.id}-${setor}-${produto.replace(/\s/g, '-')}"
                                        ${isPedidoSeparado || isSetorAlreadySent || statusAtual !== "Em separação" ? 'disabled' : ''}
                                        style="margin-left: 10px; width: 220px;"
                                    />
                                </div>
                            </div>
                        `;
                    });

                    const buttonRow = document.createElement("div");
                    buttonRow.classList.add("buttons-row");

                    const btnIniciarSeparacao = document.createElement("button");
                    btnIniciarSeparacao.textContent = `Iniciar Separação (${setor})`;
                    btnIniciarSeparacao.classList.add("btn-iniciar-separacao");
                    btnIniciarSeparacao.disabled = isPedidoSeparado || isSetorAlreadySent || statusAtual !== "Aguardando separação";
                    btnIniciarSeparacao.onclick = () => {
                        confirmarAcao(
                            `Iniciar Separação para ${setor}?`,
                            `Você está prestes a iniciar a separação do setor de ${setor} para a COT_${pedido.id}. O status do pedido será atualizado para "Em separação". Confirma?`,
                            () => {
                                setPedidoStatus(pedido.id, "Em separação");
                                renderizarPedidosPorSetor(idPedidoEspecifico);
                            }
                        );
                    };
                    buttonRow.appendChild(btnIniciarSeparacao);

                    const btnSalvarPesos = document.createElement("button");
                    btnSalvarPesos.textContent = `Salvar Pesos (${setor})`;
                    btnSalvarPesos.classList.add("btn-salvar-peso");
                    btnSalvarPesos.disabled = isPedidoSeparado || isSetorAlreadySent || statusAtual !== "Em separação";
                    btnSalvarPesos.onclick = () => salvarTodosPesosDoSetor(pedido.id, setor, pedido.produtos[setor], idPedidoEspecifico);
                    buttonRow.appendChild(btnSalvarPesos);

                    const btnEnviar = document.createElement("button");
                    btnEnviar.textContent = `Enviar (${setor})`;
                    btnEnviar.classList.add("btn-enviar");
                    btnEnviar.disabled = isPedidoSeparado || isSetorAlreadySent || statusAtual !== "Em separação";
                    btnEnviar.onclick = () => {
                        let allWeightsEntered = true;
                        pedido.produtos[setor].forEach(produto => {
                            const pesoInput = document.getElementById(`peso-${pedido.id}-${setor}-${produto.replace(/\s/g, '-')}`);
                            if (pesoInput && (pesoInput.value === '' || parseFloat(pesoInput.value) <= 0)) {
                                allWeightsEntered = false;
                            }
                                
                        });

                        if (!allWeightsEntered) {
                            showModal(
                                "Erro de Validação",
                                "Por favor, preencha o peso e o certificado para todos os produtos antes de enviar o setor.",
                                `<button class="modal-button ok" onclick="closeModal()">OK</button>`
                            );
                            return;
                        }

                        confirmarAcao(
                            `Confirmar Envio para ${setor}?`,
                            `Você está prestes a finalizar o envio do setor de ${setor} para a COT_${pedido.id}. Confirma?`,
                            () => {
                                setSetorEnviado(pedido.id, setor);
                                if (verificarTodosSetoresEnviados(pedido.id)) {
                                    setPedidoStatus(pedido.id, "Pedido separado");
                                    showModal(
                                        "Pedido Completo!",
                                        `Todos os setores da COT_${pedido.id} foram enviados, e o status foi atualizado para "Pedido Separado".`,
                                        `<button class="modal-button ok" onclick="closeModal()">OK</button>`
                                    );
                                } else {
                                    showModal(
                                        "Setor Enviado!",
                                        `O setor de ${setor} da COT_${pedido.id} foi marcado como enviado. Outros setores ainda estão pendentes.`,
                                        `<button class="modal-button ok" onclick="closeModal()">OK</button>`
                                    );
                                }
                                renderizarPedidosPorSetor(idPedidoEspecifico);
                            }
                        );
                    };
                    buttonRow.appendChild(btnEnviar);
                    setorDiv.appendChild(buttonRow);
                    pedidoCard.appendChild(setorDiv);
                });
            }
            pedidosPorSetorDiv.appendChild(pedidoCard);
        });
        document.getElementById("pedidosPorSetor").scrollTop = 0;
    }


    function salvarTodosPesosDoSetor(pedidoId, setor, produtosDoSetor, idPedidoEspecifico) {
        let dadosPeso = getDadosPesoPedido(pedidoId);
        let dadosCertificado = getDadosCertificadoPedido(pedidoId);
        let inputsAtualizados = 0;
        let validationError = false;

        produtosDoSetor.forEach(produto => {
            const pesoInput = document.getElementById(`peso-${pedidoId}-${setor}-${produto.replace(/\s/g, '-')}`);
            const certificadoInput = document.getElementById(`certificado-${pedidoId}-${setor}-${produto.replace(/\s/g, '-')}`);

            if (pesoInput && !pesoInput.disabled) {
                const peso = parseFloat(pesoInput.value);
                if (isNaN(peso) || peso <= 0) {
                    validationError = true;
                }
                if (dadosPeso[produto] === undefined || dadosPeso[produto] !== peso) {
                    dadosPeso[produto] = peso;
                    inputsAtualizados++;
                }
            }

            if (certificadoInput && !certificadoInput.disabled) {
                const certificado = certificadoInput.value.trim();
                if (dadosCertificado[produto] === undefined || dadosCertificado[produto] !== certificado) {
                    dadosCertificado[produto] = certificado;
                    inputsAtualizados++;
                }
            }
        });

        if (validationError) {
            showModal(
                "Erro de Validação",
                "Por favor, insira um peso válido (número maior que zero) para todos os produtos antes de salvar.",
                `<button class="modal-button ok" onclick="closeModal()">OK</button>`
            );
            return;
        }

        if (inputsAtualizados > 0) {
            setDadosPesoPedido(pedidoId, dadosPeso);
            setDadosCertificadoPedido(pedidoId, dadosCertificado);
            showModal(
                "Pesos Salvos!",
                `Os pesos e certificados para o setor ${setor} da COT_${pedidoId} foram salvos com sucesso.`,
                `<button class="modal-button ok" onclick="closeModal()">OK</button>`
            );
        } else {
             showModal(
                "Nenhuma Alteração!",
                "Nenhum peso ou certificado foi alterado ou não há inputs para salvar neste setor.",
                `<button class="modal-button ok" onclick="closeModal()">OK</button>`
            );
        }
        renderizarPedidosPorSetor(idPedidoEspecifico);
    }


    function exibirResumoEmbarques() {
        const embarqueSummaryDiv = document.getElementById("embarqueSummary");
        embarqueSummaryDiv.innerHTML = "";
        const resumo = {};

        let pedidosFiltrados;
        if (isMotoristaLogado) {
            pedidosFiltrados = pedidos.filter(p => p.motorista === usuarioLogado);
        } else {
            pedidosFiltrados = pedidos.filter(p => true);
        }

        const regionColors = {
            'Cariacica, ES': 'red',
            'Fundão, ES': 'red',
            'Guarapari, ES': 'red',
            'Serra, ES': 'red',
            'Vitória, ES': 'red',
            'Vila Velha, ES': 'red',
            'Viana, ES': 'red',
            'Linhares, ES': 'blue',
            'Colatina, ES': 'green',
            'Aracruz, ES': 'yellow',
            'São Mateus, ES': 'teal',
            'Cachoeiro de Itapemirim, ES': 'cyan',
            'Castelo, ES': 'indigo'
        };

        pedidosFiltrados.forEach(pedido => {
            const status = getPedidoStatus(pedido.id);
            const materialCorresponde = globalFiltroMaterial === "Todos" || Object.keys(pedido.produtos).includes(globalFiltroMaterial);

            if (status !== "Pedido separado" && materialCorresponde) {
                const embarque = pedido.embarque;
                if (!resumo[embarque]) {
                    resumo[embarque] = { count: 0, color: '' };
                    
                    for (const [region, color] of Object.entries(regionColors)) {
                        if (pedido.endereco.includes(region)) {
                            resumo[embarque].color = color;
                            break;
                        }
                    }
                    
                    if (!resumo[embarque].color) {
                        const defaultColors = ['blue', 'green', 'yellow', 'teal', 'pink', 'purple', 'orange', 'cyan'];
                        resumo[embarque].color = defaultColors[Object.keys(resumo).length % defaultColors.length];
                    }
                }
                resumo[embarque].count++;
            }
        });

        const embarquesOrdenados = Object.keys(resumo).sort();

        if (embarquesOrdenados.length === 0) {
            embarqueSummaryDiv.innerHTML = "<p style='text-align: center; color: var(--text-secondary);'>Nenhum pedido pendente por localidade.</p>";
            document.querySelector('.summary-section .filter-box-button-bottom').style.display = 'none';
            return;
        } else {
             document.querySelector('.summary-section .filter-box-button-bottom').style.display = 'block';
        }

        embarquesOrdenados.forEach(embarque => {
            const itemDiv = document.createElement("div");
            itemDiv.classList.add("summary-item");

            const colorClass = `embarque-${resumo[embarque].color}`;
            itemDiv.classList.add(colorClass);

            itemDiv.innerHTML = `
                <span>Rota ${embarque}: ${resumo[embarque].count} pedidos</span>
                <button onclick="viewPedidosFromSummary('${embarque}')" 
                        style="padding: 8px 16px; border-radius: 4px; border: none; 
                              font-weight: 500; cursor: pointer; transition: all 0.3s ease;">
                    Ver Pedidos
                </button>
            `;
            embarqueSummaryDiv.appendChild(itemDiv);
        });
    }

    function viewPedidosFromSummary(embarque) {
        globalFiltroRota = (embarque === '') ? "todas" : embarque;
        globalFiltroStatus = "todas";
        pedidoUnicoVisualizado = null;

        showMainAppScreen();
    }

    function goBackToFilterScreen() {
        showFilterScreen();
    }

    function viewSingleOrder(pedidoId) {
        pedidoUnicoVisualizado = pedidoId;
        globalFiltroRota = "todas";
        globalFiltroStatus = "todas";
        showMainAppScreen();
    }

    function goBackToAllOrders() {
        pedidoUnicoVisualizado = null;
        globalFiltroRota = previousGlobalFiltroRota;
        globalFiltroStatus = previousGlobalFiltroStatus;
        showMainAppScreen();
    }


    function showModal(title, message, buttonsHtml) {
        document.getElementById("modalTitle").textContent = title;
        document.getElementById("modalMessage").innerHTML = message;
        document.getElementById("modalButtons").innerHTML = buttonsHtml;
        document.getElementById("modalOverlay").classList.add("active");
    }

    function closeModal() {
        document.getElementById("modalOverlay").classList.remove("active");
    }

    function confirmarAcao(title, message, onConfirm) {
        window._onConfirmAction = onConfirm;
        showModal(
            title,
            message,
            `
            <button class="modal-button cancel" onclick="closeModal()">Cancelar</button>
            <button class="modal-button confirm" onclick="closeModal(); window._onConfirmAction();">Confirmar</button>
            `
        );
    }

    function aplicarFiltroStatusPrincipal(status, clickedButton) {
        globalFiltroStatus = status;
        const buttons = document.querySelectorAll('#mainAppStatusFilters button');
        buttons.forEach(button => button.classList.remove('active'));
        clickedButton.classList.add('active');
        renderizarPedidosPorSetor(pedidoUnicoVisualizado);
    }


    function exibirCotasPorEmbarque(pedidoId = null) {
        const quotationsSection = document.getElementById("quotationsByEmbarque");
        const quotationListDiv = document.getElementById("quotationList");
        quotationListDiv.innerHTML = "";

        if (!pedidoId || pedidoId === null) {
            quotationsSection.style.display = "none";
            return;
        }

        const pedido = pedidos.find(p => p.id === pedidoId);
        if (!pedido) {
            quotationsSection.style.display = "none";
            return;
        }

        if (cotasDoEmbarque.length > 0) {
            cotasDoEmbarque.forEach((cota, index) => {
                const itemDiv = document.createElement("div");
                itemDiv.classList.add("quotation-item");
                itemDiv.innerHTML = `
                    <span>${cota}</span>
                    <button onclick="selecionarCota('${cota}')">Selecionar</button>
                `;
                quotationListDiv.appendChild(itemDiv);
            });
            quotationsSection.style.display = "block";
        } else {
            quotationsSection.style.display = "none";
        }
    }

    function confirmResetAllData() {
        showModal(
            "Zerar Todos os Dados?",
            "Esta ação irá reiniciar todos os pesos lançados, status de separação e envio por setor para TODOS os pedidos. Deseja realmente prosseguir?",
            `
            <button class="modal-button cancel" onclick="closeModal()">Cancelar</button>
            <button class="modal-button confirm" style="background-color: var(--red-error);" onclick="resetAllOrderData()">Sim, Zerar Tudo</button>
            `
        );
    }


    function resetAllOrderData() {
        closeModal();
        
        const keysToRemove = [];
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key.startsWith(localStorageDadosPesoKey) ||
                key.startsWith(localStorageCertificadoKey) ||
                key.startsWith(localStorageSetorEnviadoKey) ||
                key.startsWith(localStoragePedidoStatusKey)) {
                keysToRemove.push(key);
            }
        }
        keysToRemove.forEach(key => localStorage.removeItem(key));

        pedidos.forEach(p => {
            p.status = "Aguardando separação";
        });

        showModal(
            "Dados Zerados!",
            "Todos os dados de peso, envio por setor e status de separação foram reiniciados. Você será redirecionado para a tela de filtros.",
            `<button class="modal-button ok" onclick="closeModal(); goBackToFilterScreen();">Ok</button>`
        );
    }

    document.addEventListener("DOMContentLoaded", () => {
        showUserSelectionPage();
    });

</script>

</body>
</html>
